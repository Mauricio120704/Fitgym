<!-- Restored sidebar fragment with role-aware sections. Keep guards on CSRF to avoid null-evaluation issues. -->
<aside th:fragment="sidebar(activeMenu='')" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" id="sidebar" class="w-20 bg-white shadow-md absolute inset-y-0 left-0 transform -translate-x-full md:relative md:translate-x-0 transition-all duration-300 ease-in-out z-30">
    <div class="p-4 border-b flex justify-center items-center">
        <h2 class="sidebar-title text-xl font-bold text-gray-800 hidden">Sistema de Gestión</h2>
        <svg class="sidebar-icon h-8 w-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l9-9 9 9M4 10v10a1 1 0 001 1h4a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1h4a1 1 0 001-1V10"/>
        </svg>
        <button id="close-sidebar" class="md:hidden text-gray-600 hover:text-gray-800 absolute right-2">
            <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
        </button>
    </div>

    <nav class="mt-4">
        <!-- Cliente / Deportista menu -->
        <div sec:authorize="hasRole('CLIENTE')">
            <ul class="mt-2">
                <li>
                    <a th:href="@{/perfil}" th:classappend="${activeMenu == 'perfil'} ? 'text-blue-600 bg-blue-100 font-semibold' : 'text-gray-700 hover:bg-gray-200'" class="flex items-center justify-center py-3" title="Mi Perfil">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                        <span class="sidebar-text ml-3 hidden">Mi Perfil</span>
                    </a>
                </li>
                <li>
                    <a th:href="@{/evaluaciones}" th:classappend="${activeMenu == 'evaluaciones'} ? 'text-blue-600 bg-blue-100 font-semibold' : 'text-gray-700 hover:bg-gray-200'" class="flex items-center justify-center py-3" title="Evaluaciones">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2"></path></svg>
                        <span class="sidebar-text ml-3 hidden">Evaluaciones</span>
                    </a>
                </li>
                <li>
                    <a th:href="@{/reservas}" th:classappend="${activeMenu == 'reservas'} ? 'text-blue-600 bg-blue-100 font-semibold' : 'text-gray-700 hover:bg-gray-200'" class="flex items-center justify-center py-3" title="Reservas">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3M5 11h14M5 19h14M5 11a2 2 0 012-2h10a2 2 0 012 2M5 19a2 2 0 002 2h10a2 2 0 002-2"/></svg>
                        <span class="sidebar-text ml-3 hidden">Reservas</span>
                    </a>
                </li>
                <li>
                    <a th:href="@{/deportista/mis-clases}" th:classappend="${activeMenu == 'mis-clases'} ? 'text-blue-600 bg-blue-100 font-semibold' : 'text-gray-700 hover:bg-gray-200'" class="flex items-center justify-center py-3" title="Mis Clases">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <span class="sidebar-text ml-3 hidden">Mis Clases</span>
                    </a>
                </li>
                <li>
                    <a th:href="@{/reclamos}" th:classappend="${activeMenu == 'reclamos'} ? 'text-blue-600 bg-blue-100 font-semibold' : 'text-gray-700 hover:bg-gray-200'" class="flex items-center justify-center py-3" title="Reclamos">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4"></path></svg>
                        <span class="sidebar-text ml-3 hidden">Reclamos</span>
                    </a>
                </li>
            </ul>
        </div>

       <!-- Personal / Admin menu: only visible to administrative roles -->
       <div sec:authorize="hasAnyRole('ADMINISTRADOR','RECEPCIONISTA','ENTRENADOR')">
            <span class="sidebar-text px-4 text-sm font-semibold text-gray-500 hidden">Gestión</span>
            <ul class="mt-2">
                <li>
                    <a th:href="@{/reportes/asistencia-clases}" th:classappend="${activeMenu == 'reporte-asistencia'} ? 'text-blue-600 bg-blue-100 font-semibold' : 'text-gray-700 hover:bg-gray-200'" class="flex items-center justify-center py-3" title="Reporte de Asistencia">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l9-9 9 9M4 10v10a1 1 0 001 1h4a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1h4a1 1 0 001-1V10"/></svg>
                        <span class="sidebar-text ml-3 hidden">Reporte de Asistencia a Clases</span>
                    </a>
                </li>
                <!-- Registrar removed as requested -->
                <li>
                    <a th:href="@{/miembros}" th:classappend="${activeMenu == 'miembros'} ? 'text-blue-600 bg-blue-100 font-semibold' : 'text-gray-700 hover:bg-gray-200'" class="flex items-center justify-center py-3" title="Personal">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a4 4 0 00-4-4H6a4 4 0 00-4 4v2h5m6-11a4 4 0 11-8 0 4 4 0 018 0z"/></svg>
                        <span class="sidebar-text ml-3 hidden">Personal</span>
                    </a>
                </li>
                <li>
                    <a th:href="@{/incidencias}" th:classappend="${activeMenu == 'incidencias'} ? 'text-blue-600 bg-blue-100 font-semibold' : 'text-gray-700 hover:bg-gray-200'" class="flex items-center justify-center py-3" title="Incidencias">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01M10 3h4l1 7H9l1-7zM5 21h14l-1-7H6l-1 7z"/></svg>
                        <span class="sidebar-text ml-3 hidden">Incidencias</span>
                    </a>
                </li>
                <li>
                    <a th:href="@{/promociones}" th:classappend="${activeMenu == 'promociones'} ? 'text-blue-600 bg-blue-100 font-semibold' : 'text-gray-700 hover:bg-gray-200'" class="flex items-center justify-center py-3" title="Promociones">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h10a2 2 0 012 2v6a2 2 0 01-2 2H7l-4 3V9a2 2 0 012-2h2m7 3l-2 2m0 0l-2-2m2 2l2 2m-2-2l-2 2"/>
                        </svg>
                        <span class="sidebar-text ml-3 hidden">Promociones</span>
                    </a>
                </li>
                <li>
                    <a th:href="@{/pagos}" th:classappend="${activeMenu == 'pagos'} ? 'text-blue-600 bg-blue-100 font-semibold' : 'text-gray-700 hover:bg-gray-200'" class="flex items-center justify-center py-3" title="Pagos">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2 7h20M2 11h20M2 15h20M7 19h10M8 3h8"/></svg>
                        <span class="sidebar-text ml-3 hidden">Pagos</span>
                    </a>
                </li>
                <li>
                    <a th:href="@{/clases}" th:classappend="${activeMenu == 'clases'} ? 'text-blue-600 bg-blue-100 font-semibold' : 'text-gray-700 hover:bg-gray-200'" class="flex items-center justify-center py-3" title="Clases">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3M5 11h14M5 19h14M7 11v8m5-8v8m5-8v8"/></svg>
                        <span class="sidebar-text ml-3 hidden">Clases</span>
                    </a>
                </li>
                <li>
                    <a th:href="@{/admin/invitados}" th:classappend="${activeMenu == 'invitados'} ? 'text-blue-600 bg-blue-100 font-semibold' : 'text-gray-700 hover:bg-gray-200'" class="flex items-center justify-center py-3" title="Invitados">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/></svg>
                        <span class="sidebar-text ml-3 hidden">Invitados</span>
                    </a>
                </li>
                <li>
                    <a th:href="@{/admin/visitantes/listado}" th:classappend="${activeMenu == 'visitantes'} ? 'text-blue-600 bg-blue-100 font-semibold' : 'text-gray-700 hover:bg-gray-200'" class="flex items-center justify-center py-3" title="Visitantes">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
                        <span class="sidebar-text ml-3 hidden">Visitantes</span>
                    </a>
                </li>
                
                <!-- Secciones específicas de Recepcionista -->
                <li sec:authorize="hasAnyRole('ADMINISTRADOR','RECEPCIONISTA')">
                    <a th:href="@{/asistencia}" th:classappend="${activeMenu == 'asistencia'} ? 'text-blue-600 bg-blue-100 font-semibold' : 'text-gray-700 hover:bg-gray-200'" class="flex items-center justify-center py-3" title="Asistencia">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
                        </svg>
                        <span class="sidebar-text ml-3 hidden">Asistencia</span>
                    </a>
                </li>
                <li sec:authorize="hasAnyRole('ADMINISTRADOR','RECEPCIONISTA')">
                    <a th:href="@{/lockers}" th:classappend="${activeMenu == 'lockers'} ? 'text-blue-600 bg-blue-100 font-semibold' : 'text-gray-700 hover:bg-gray-200'" class="flex items-center justify-center py-3" title="Lockers">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                        </svg>
                        <span class="sidebar-text ml-3 hidden">Lockers</span>
                    </a>
                </li>
                <li sec:authorize="hasAnyRole('ADMINISTRADOR','RECEPCIONISTA')">
                    <a th:href="@{/monitoreo}" th:classappend="${activeMenu == 'monitoreo-capacidad'} ? 'text-blue-600 bg-blue-100 font-semibold' : 'text-gray-700 hover:bg-gray-200'" class="flex items-center justify-center py-3" title="Monitoreo de Capacidad">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                        </svg>
                        <span class="sidebar-text ml-3 hidden">Monitoreo</span>
                    </a>
                </li>
                
                <li sec:authorize="hasRole('ENTRENADOR')">
                    <a th:href="@{/entrenador/mis-deportistas}" th:classappend="${activeMenu == 'mis-deportistas'} ? 'text-blue-600 bg-blue-100 font-semibold' : 'text-gray-700 hover:bg-gray-200'" class="flex items-center justify-center py-3" title="Mis Deportistas">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/></svg>
                        <span class="sidebar-text ml-3 hidden">Mis Deportistas</span>
                    </a>
                </li>
                <li sec:authorize="hasRole('ADMINISTRADOR')">
                    <a th:href="@{/reportes/ingresos-membresias}" th:classappend="${activeMenu == 'reportes'} ? 'text-blue-600 bg-blue-100 font-semibold' : 'text-gray-700 hover:bg-gray-200'" class="flex items-center justify-center py-3" title="Reportes">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                        <span class="sidebar-text ml-3 hidden">Reportes Financieros</span>
                    </a>
                </li>
            </ul>
        </div>

        <!-- Logout button (guarded CSRF) -->
        <div class="mt-4">
            <form th:action="@{/logout}" method="post" class="w-full">
                <input th:if="${_csrf != null}" type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <button type="submit" class="flex items-center justify-center py-3 text-red-600 hover:bg-red-50 w-full" title="Cerrar Sesión">
                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7"></path></svg>
                    <span class="sidebar-text ml-3 hidden">Cerrar Sesión</span>
                </button>
            </form>
        </div>
    </nav>
</aside>
